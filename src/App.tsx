import { useEffect } from "react";
import styled, { ThemeProvider } from 'styled-components'
import Menu from './components/Menu'
import Button from './components/Button'
import { Outlet, NavLink, useNavigate } from "react-router-dom";
import { testGet } from './utils/http';
import Logo from '@/assets/logo.png'
import Dialog from './components/Dialog';
import WechatQR from '@/assets/wechatqrcode.png'
import { changeLanguage } from "i18next";
import { useTranslation } from "react-i18next";
import i18n from '@/i18n'

export const theme = {
  normal: '#000',
  blue: "rgb(72, 152, 218)", // blue
  deepBlue: '#096398',
  lightBlue: '#2bd5ff',
  green: '#10a37f',
  deepGreen: '#1a7f64',
  disabledBg: '#f5f7fa',
  disabledColor: '#c4c7cc',
  red: '#f52743'
};

const Main = styled.div`
  flex: 1;
  height: 100%;
  margin: 0 8px 8px 8px;
  display: flex;
  background-color: #fff;
  border-radius: 8px;
`

const TopBar = styled.div`
  position: sticky;
  top: 0;
  z-index: 1000;
  display: flex;
  justify-content: flex-start;
  align-items: center;
  box-shadow: var(--shadow-header);
  backface-visibility: hidden;
  height: 4em;
  background-color: #ffffff;
  box-shadow: 0 2px 4px -1px rgba(0, 0, 0, 0.25);
  backface-visibility: hidden;
  padding-right: 60px;
`

const Content = styled.div`
  padding: 20px 40px 80px 40px;
  line-height: 1.5;
`

const Sep = styled.div`
  width: 20px;
`

export const StyledNavLink = styled(NavLink)<{ $active?: boolean }>`
  font-size: 16px;
  color: ${props => props.theme.green};
  cursor: pointer;
  &:hover {
    color: #1a7f64;
  }
  text-decoration: none;
`

const StyledGrid = styled.div`
  padding: 40px 0;
  display: grid;
  grid-template-columns: auto auto;
  grid-gap: 10px;
  .right-align {
    text-align: right;
  }
  .left-align {
    text-align: left;
  }
`

function App() {
  const navigate = useNavigate()
  const { t } = useTranslation()
  const doGet = async() => {
    let res = await testGet()
    console.log('res get', res)
  }
  useEffect(() => {
    doGet()
  }, [])

  const toUpload = () => {
    navigate('/new-book')
  }

  const contactMe = () => {
    const onOk = () => {
      dialog.hide()
    }
    const dialog = Dialog.confirm({
      title:t('Contact me'),
      content: (
        <StyledGrid>
          <div className="right-align">
            {t('WeChat')}&nbsp;<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2360" width="20" height="20"><path d="M695.296 346.112c11.776 0 23.552 1.024 34.816 2.048-31.232-146.432-187.904-254.976-366.592-254.976-199.68 0-363.52 136.192-363.52 308.736 0 99.84 54.272 181.76 145.408 245.248l-36.352 109.056L236.032 692.736c45.568 9.216 81.92 18.432 127.488 18.432 11.264 0 22.528-0.512 33.792-1.536-7.168-24.064-11.264-49.664-11.264-76.288 0.512-158.208 136.704-287.232 309.248-287.232zM497.664 240.64c31.232 0 56.32 25.088 56.32 56.32s-25.088 56.32-56.32 56.32-56.32-25.088-56.32-56.32 25.088-56.32 56.32-56.32zM243.2 353.792c-31.232 0-56.32-25.088-56.32-56.32s25.088-56.32 56.32-56.32 56.32 25.088 56.32 56.32-25.088 56.32-56.32 56.32zM1024.512 630.784c0-145.408-145.408-263.68-308.736-263.68-173.056 0-309.248 118.272-309.248 263.68s136.192 263.68 309.248 263.68c36.352 0 72.704-9.216 109.056-18.432l99.84 54.784-27.136-90.624c72.704-54.784 126.976-127.488 126.976-209.408z m-403.456-40.96c-22.016 0-39.936-17.92-39.936-39.936s17.92-39.936 39.936-39.936 39.936 17.92 39.936 39.936-17.92 39.936-39.936 39.936z m199.68 2.56c-22.016 0-39.936-17.92-39.936-39.936s17.92-39.936 39.936-39.936 39.936 17.92 39.936 39.936-17.92 39.936-39.936 39.936z" fill="#69BB64" p-id="2361"></path></svg>
          </div>
          <div className="left-align">
            <img src={WechatQR} style={{width: '80px'}} alt="wechat" />
          </div>
          <div className="right-align">
            {t('Email')}&nbsp;<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4292" width="20" height="20"><path d="M577.909484 577.05348h-126.907006c-41.453675 0-75.057412-33.603737-75.057412-75.057412v-150.010825c0-41.453675 33.603737-75.057412 75.057412-75.057412h126.907006c41.453675 0 75.059412 33.603737 75.059412 75.057412V501.996068c0 41.453675-33.605737 75.057412-75.059412 75.057412z" fill="#F58E6F" p-id="4293"></path><path d="M987.096279 1023.99198H36.891721a7.931938 7.931938 0 0 1-7.445942-5.193959 7.931938 7.931938 0 0 1 2.299982-8.783931l475.102279-404.81483a7.935938 7.935938 0 0 1 10.29192 0l475.102279 404.81483a7.931938 7.931938 0 0 1 2.299982 8.783931A7.931938 7.931938 0 0 1 987.096279 1023.99198z m-928.652727-15.871876h907.100896L511.994 621.669131 58.443552 1008.120104z" fill="#4A555F" p-id="4294"></path><path d="M108.727158 989.600249l403.266842-343.603308 403.266842 343.603308z" fill="#DFDFDF" p-id="4295"></path><path d="M36.891721 1023.99198a7.933938 7.933938 0 0 1-7.935938-7.937938v-620.47514a7.937938 7.937938 0 0 1 13.057898-6.065953L407.820816 698.300531a7.937938 7.937938 0 0 1 0.026 12.105905L42.039681 1022.097995a7.939938 7.939938 0 0 1-5.14796 1.893985z m7.937938-611.327212v586.201409L390.428952 704.394483 44.829659 412.664768z" fill="#4A555F" p-id="4296"></path><path d="M63.347514 452.530456l298.449662 251.932027-298.449662 254.298008z" fill="#DFDFDF" p-id="4297"></path><path d="M987.096279 1023.99198a7.933938 7.933938 0 0 1-5.14596-1.893985L616.143184 710.408436a7.931938 7.931938 0 0 1 0.026-12.105905L981.976319 389.514949a7.935938 7.935938 0 0 1 13.057898 6.065953v620.47714A7.937938 7.937938 0 0 1 987.096279 1023.99198zM633.561048 704.396483l345.599293 294.471694V412.664768L633.561048 704.396483z" fill="#4A555F" p-id="4298"></path><path d="M662.190824 704.462483l298.451662-251.932027v506.230035z" fill="#DFDFDF" p-id="4299"></path><path d="M402.724856 712.306421a7.925938 7.925938 0 0 1-5.11996-1.871985L130.784986 485.1982a7.927938 7.927938 0 0 1-2.815978-6.063953V229.138205a7.937938 7.937938 0 0 1 7.935938-7.935937h752.208108a7.937938 7.937938 0 0 1 7.935938 7.935937v249.996042a7.925938 7.925938 0 0 1-2.815978 6.063953L626.411104 710.434436a7.931938 7.931938 0 0 1-10.26592-0.024L511.98 621.675131l-104.107184 88.733305a7.919938 7.919938 0 0 1-5.14796 1.897985z m109.255144-108.993146a7.919938 7.919938 0 0 1 5.14596 1.893985l104.191184 88.755305L880.177116 475.448276V237.074143H143.842883v238.372133l258.855973 218.514289 104.133184-88.753305a7.923938 7.923938 0 0 1 5.14796-1.893985z" fill="#4A555F" p-id="4300"></path><path d="M611.793218 542.873748H476.420279c-42.13567 0-76.419401-34.279732-76.419402-76.415401v-87.123318c0-42.13567 34.281732-76.415402 76.419402-76.415401h66.895476c42.13567 0 76.413402 34.279732 76.413401 76.415401v83.431347c0 18.431856-14.993883 33.427738-33.423738 33.427738-19.541847 0-36.549714-11.065913-45.085647-27.259787-6.34995 9.049929-13.727892 17.565862-25.435801 22.595823-16.735869 7.197944-36.757712 5.439957-49.80961-4.375965-10.137921-7.62794-21.891829-22.503824-20.31184-50.037609 2.427981-42.367668 24.641807-70.615447 62.54551-79.545377 10.333919-2.435981 21.091835-0.016 29.503769 6.643948a35.483722 35.483722 0 0 1 13.541894 27.971781v53.081585c0 19.325849 15.723877 35.051725 35.051725 35.051725 9.677924 0 17.551863-7.873938 17.551863-17.553862v-83.431347c0-33.383739-27.157787-60.543526-60.541526-60.543526H476.420279c-33.383739 0-60.545526 27.159787-60.545526 60.543526v87.123318c0 33.383739 27.161787 60.541526 60.545526 60.541526h135.372939v15.873875z m-95.67525-170.350666a18.599854 18.599854 0 0 0-4.273967 0.497996c-31.347754 7.385942-48.285622 29.255771-50.341606 65.003491-0.939993 16.475871 3.77197 28.739775 14.017891 36.447715 8.509933 6.40395 22.491824 7.419942 33.997733 2.473981 10.437918-4.485965 16.415871-13.527894 23.333818-23.995813 0.883993-1.33199 1.761986-2.665979 2.659979-3.995968a51.0756 51.0756 0 0 1-0.133999-3.685971v-53.081585a19.713846 19.713846 0 0 0-7.523941-15.529878 18.873852 18.873852 0 0 0-11.735908-4.133968zM135.906946 487.080185a7.939938 7.939938 0 0 1-5.11996-1.871985l-98.993225-83.541346a7.933938 7.933938 0 0 1 0.103999-12.211904l98.993225-80.791367a7.945938 7.945938 0 0 1 8.421934-1.021992 7.943938 7.943938 0 0 1 4.531964 7.169943v164.332713a7.937938 7.937938 0 0 1-7.937937 7.935938z m-86.567322-91.375284l78.629384 66.35748v-130.530978l-78.629384 64.173498zM783.085877 237.084143H240.876123a7.935938 7.935938 0 0 1-5.01596-14.08389L506.962039 1.787986a7.931938 7.931938 0 0 1 10.033922 0L788.103838 222.998253a7.935938 7.935938 0 1 1-5.017961 14.08589z m-519.929928-15.871876h497.650102L511.98 18.179858 263.155949 221.212267z" fill="#4A555F" p-id="4301"></path><path d="M315.141542 202.692413l196.836458-160.610743 196.840459 160.610743z" fill="#DFDFDF" p-id="4302"></path><path d="M888.115054 487.080185a7.933938 7.933938 0 0 1-7.937938-7.935938v-164.332713c0-3.065976 1.767986-5.855954 4.531965-7.169943a7.941938 7.941938 0 0 1 8.421934 1.021992l98.993225 80.791367a7.929938 7.929938 0 0 1 0.103999 12.211904l-98.993225 83.541346a7.941938 7.941938 0 0 1-5.11996 1.871985z m7.935938-155.548782v130.530978l78.629384-66.35748-78.629384-64.173498z" fill="#4A555F" p-id="4303"></path></svg>
          </div>
          <div className="left-align">
            <a style={{flex: 1}} href="mailto:403392669@qq.com">403392669@qq.com</a>
          </div>
          <div className="right-align">
            {t('Mobile phone')}&nbsp;<svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7171" width="20" height="20"><path d="M675.072 64H348.928c-56.256 0-101.888 45.632-101.888 101.76v692.48c0 56.128 45.632 101.76 101.888 101.76h326.144c56.256 0 101.888-45.632 101.888-101.76V165.76c0-56.128-45.632-101.76-101.888-101.76zM512 919.296a61.056 61.056 0 1 1 0-122.24 61.056 61.056 0 1 1 0 122.24z m183.424-162.944H328.576V186.24h366.848v570.24z" fill="#15161B" p-id="7172"></path></svg>
          </div>
          <div className="left-align">86-13616512778</div>
        </StyledGrid>
      ),
      footer: (
        <footer style={{display: 'flex', flexDirection: 'row-reverse'}}>
          <Button size="small" onClick={onOk}>{t('Confirm')}</Button>&nbsp;
        </footer>
      )
    })
  }

  const setLanguage = () => {
    const language = localStorage.getItem('language')
    // if language is already set on localStorage
    if (language) {
      changeLanguage(language)
    } else {
      localStorage.setItem('language', i18n.language)
    }
  }

  useEffect(() => {
    setLanguage()
  }, [])

  const _changeLanguage = () => {
    const language = localStorage.getItem('language')
    if (!language || language === 'en') {
      changeLanguage('zh')
      localStorage.setItem('language', 'zh')
    } else {
      changeLanguage('en')
      localStorage.setItem('language', 'en')
    }
  }

  const toGithub = () => {
    window.open('https://github.com/hu-ke/reader-guru-fe', '_blank')
  }

  return (
    <ThemeProvider theme={theme}>
      <TopBar>
        <div style={{cursor: 'pointer', display: 'flex', alignItems: 'center', marginRight: 'auto'}}>
          <img src={Logo} alt="logo" style={{width: '50px', marginLeft: '100px'}} />
          <div style={{marginLeft: '20px', marginRight: 'auto', fontFamily: 'Helloyasmin', letterSpacing: '4px', fontSize: '20px'}}>{t('Your AI Reading Assistant')}</div>
        </div>
        <>
          {t('Any suggestions?')} &nbsp;<Button size="medium" text onClick={contactMe}>{t('contact me')}</Button>
          <Sep />
          <Button onClick={toUpload}>
            {t('Upload a book')}&nbsp;
            <svg fill="#fff" className="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2152" width="20" height="20"><path d="M554.688 500.352v256H469.312v-256h-128L512 314.24l170.688 186.24h-128zM1024 640.192C1024 782.912 919.872 896 787.648 896h-512C123.904 896 0 761.6 0 597.504 0 451.968 94.656 331.52 226.432 302.976 284.16 195.456 391.808 128 512 128c152.32 0 282.112 108.416 323.392 261.12C941.888 413.44 1024 519.04 1024 640.192z m-259.2-205.312c-24.448-129.024-128.896-222.72-252.8-222.72-97.28 0-183.04 57.344-224.64 147.456l-9.28 20.224-20.928 2.944c-103.36 14.4-178.368 104.32-178.368 214.72 0 117.952 88.832 214.4 196.928 214.4h512c88.32 0 157.504-75.136 157.504-171.712 0-88.064-65.92-164.928-144.96-171.776l-29.504-2.56-5.888-30.976z" p-id="2153"></path></svg>
          </Button>
          <Sep />
          <svg onClick={_changeLanguage} style={{cursor: 'pointer'}} viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4981" width="30" height="30"><path d="M885.333333 774.4L768 490.666667h-85.333333l-51.2 119.466666c-38.4-19.2-119.466667-61.866667-185.6-113.066666 66.133333-74.666667 102.4-170.666667 117.333333-221.866667H661.333333V192H422.4L405.333333 98.133333l-85.333333 17.066667 17.066667 76.8H106.666667v85.333333h96c14.933333 49.066667 53.333333 147.2 117.333333 221.866667-91.733333 70.4-209.066667 123.733333-211.2 123.733333l36.266667 76.8c6.4-2.133333 136.533333-61.866667 238.933333-142.933333 78.933333 61.866667 172.8 110.933333 215.466667 132.266667l-17.066667 40.533333-17.066667 42.666667-51.2 128 78.933334 32 40.533333-100.266667h181.333333l40.533334 100.266667 78.933333-32-49.066667-125.866667zM475.733333 277.333333c-17.066667 46.933333-46.933333 113.066667-91.733333 164.266667-44.8-51.2-74.666667-117.333333-91.733333-164.266667h183.466666z m192 469.333334l57.6-134.4 57.6 134.4h-115.2z" fill="#4E5969" p-id="4982"></path></svg>
          <Sep />
          <svg onClick={toGithub} style={{cursor: 'pointer'}} viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2384" width="30" height="30"><path d="M512 42.666667A464.64 464.64 0 0 0 42.666667 502.186667 460.373333 460.373333 0 0 0 363.52 938.666667c23.466667 4.266667 32-9.813333 32-22.186667v-78.08c-130.56 27.733333-158.293333-61.44-158.293333-61.44a122.026667 122.026667 0 0 0-52.053334-67.413333c-42.666667-28.16 3.413333-27.733333 3.413334-27.733334a98.56 98.56 0 0 1 71.68 47.36 101.12 101.12 0 0 0 136.533333 37.973334 99.413333 99.413333 0 0 1 29.866667-61.44c-104.106667-11.52-213.333333-50.773333-213.333334-226.986667a177.066667 177.066667 0 0 1 47.36-124.16 161.28 161.28 0 0 1 4.693334-121.173333s39.68-12.373333 128 46.933333a455.68 455.68 0 0 1 234.666666 0c89.6-59.306667 128-46.933333 128-46.933333a161.28 161.28 0 0 1 4.693334 121.173333A177.066667 177.066667 0 0 1 810.666667 477.866667c0 176.64-110.08 215.466667-213.333334 226.986666a106.666667 106.666667 0 0 1 32 85.333334v125.866666c0 14.933333 8.533333 26.88 32 22.186667A460.8 460.8 0 0 0 981.333333 502.186667 464.64 464.64 0 0 0 512 42.666667" fill="#231F20" p-id="2385"></path></svg>
        </>
      </TopBar>
      <Main>
        <Menu></Menu>
        <Content>
          <Outlet />
        </Content>
      </Main>
    </ThemeProvider>
  )
}

export default App